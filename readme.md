# NODEHTTP
## Lightweight express alternative with similar syntax and usage.

<a href="https://www.npmjs.com/package/sys-nodehttp">![Download](https://img.shields.io/npm/dw/sys-nodehttp?style=for-the-badge)</a>

### Installation:

```sh
npm i sys-nodehttp
```

### Usage:

```js
var path = require('path'),
	nodehttp = require('sys-nodehttp'),
	server = new nodehttp.server({
		// relative to the script, /public/
		static: path.join(__dirname, 'public'),
		port: process.env.PORT || 8080,
		address: '0.0.0.0',
	});

server.get('/api', (req, res) => {
	res.send('Hello world!');
});

server.post('/api', (req, res) => {
	// req.body is an object
	console.log('Recieved POST with body:', req.body);
});

server.use(nodehttp.static(path.join(__dirname, 'public')));
```

### Execution:

Unlike express, a way to do calculations or use data serverside is included. The server objects `execution` param contains file extensions that will be capable of executing code, like php except with JS.

## Notes:

- A small amount of PHP functions are implemented such as filemtime, echo, count, include
- `file` is a function that will resolve any path from the webserver root
- `require` is supported
- `include` is async, you will need `await` before it
- `filemtime` does work but it is recommended to use the async function `afilemtimems`
- All code snippets are asynchronous, you can run async code as long as async functions are awaited for and the snippet is resolved
- a folder in your static folder called `cgi` is needed to store stuff eg error.php
- error.php has the variables `title` and `message`

## Usage:

Example 1:

```
<!-- index.php -->
<h1>My web page</h1>

<p>1000 divided by 2:</p>
<?php
echo(1e3 / 2);
?>

<p>You are currently on <?=req.url.host?></p>
```

Example 2, delaying the response:

```
<?php

var duration = 3; // seconds

await new Promise(resolve => setTimeout(() => resolve(), duration * 1000));

echo('No echo is needed, the async function ends with or without');
?>
<p>Hello world!</p>
```

Example 3, including "relative.php":

```
<!--
folder structure looks like:
- index.php
- relative.php
-->


<main>
	<?=await include('./relative.php')?>
</main>
```

### API:
<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [fetch][1]
    -   [Parameters][2]
-   [request][3]
    -   [Parameters][4]
    -   [Properties][5]
    -   [process][6]
-   [response][7]
    -   [Parameters][8]
    -   [Properties][9]
    -   [status][10]
        -   [Parameters][11]
    -   [get][12]
        -   [Parameters][13]
    -   [set][14]
        -   [Parameters][15]
    -   [append][16]
        -   [Parameters][17]
    -   [finalize][18]
    -   [pipe_from][19]
        -   [Parameters][20]
    -   [pipe][21]
        -   [Parameters][22]
    -   [write][23]
        -   [Parameters][24]
    -   [end][25]
        -   [Parameters][26]
    -   [send][27]
        -   [Parameters][28]
    -   [json][29]
        -   [Parameters][30]
    -   [compress][31]
        -   [Parameters][32]
    -   [error][33]
        -   [Parameters][34]
    -   [redirect][35]
        -   [Parameters][36]
    -   [contentType][37]
        -   [Parameters][38]
-   [sanitize][39]
    -   [Parameters][40]
-   [server][41]
    -   [Parameters][42]
    -   [alias][43]
        -   [Parameters][44]
-   [etag][45]
    -   [Parameters][46]
-   [static][47]
    -   [Parameters][48]
    -   [Examples][49]

## fetch

Send a client request, similar to fetch

### Parameters

-   `url`  
-   `opts`   (optional, default `{}`)
-   `URL` **([URL][50] \| [string][51])** 
-   `Options` **[Object][52]?** 

Returns **[Promise][53]** exports.client_response

## request

**Extends events**

Base request class

### Parameters

-   `request` **[Object][52]** 
-   `response` **[Object][52]** 
-   `server` **[Object][52]** 

### Properties

-   `headers` **[Object][52]** Contains HTTP headers
-   `body` **([Object][52] \| [String][51] \| [Array][54] \| [Number][55])** Contains POST body if applicable (once process is called)
-   `url` **[URL][50]** URL object from request (contains host)

### process

Process the POST data if applicable

Returns **[Promise][53]** 

## response

**Extends events**

Base response class

### Parameters

-   `request` **[Object][52]** 
-   `response` **[Object][52]** 
-   `server` **[Object][52]** 

### Properties

-   `cookies` **[Object][52]** Cookies (if modified, set-cookies will be overwritten, format is { name: '', value: '', secure: true|false, httponly: true|false, domain: '', path: '/', expires: Date }
-   `body` **([Object][52] \| [String][51] \| [Array][54] \| [Number][55])** Contains POST body if applicable (once process is called)
-   `headers` **[URL][50]** Set headers

### status

Set the response status code

#### Parameters

-   `code`  
-   `HTTP` **[Number][55]** Status

### get

Gets a set header

#### Parameters

-   `name`  
-   `Name` **[String][51]** 
-   `Value` **[String][51]** 

### set

Set a header

#### Parameters

-   `name`  
-   `value`  
-   `Name` **[String][51]** 
-   `Value` **[String][51]** 

### append

Appends to a header

#### Parameters

-   `name`  
-   `value`  
-   `Name` **[String][51]** 
-   `Value` **[String][51]** 

### finalize

Meant to be called internally, finalizes request preventing writing headers

### pipe_from

Pipes the stream to the response

#### Parameters

-   `stream`  
-   `Stream` **[Stream][56]** 

### pipe

Pipes response into stream

#### Parameters

-   `stream`  
-   `Stream` **[Stream][56]** 

### write

Writes data to the response

#### Parameters

-   `data`  
-   `Body` **([String][51] \| [Buffer][57])?** 

### end

Closes the response with any additional data

#### Parameters

-   `data`  
-   `Body` **([String][51] \| [Buffer][57])** 

### send

Closes the response with data and sends headers

#### Parameters

-   `body`  
-   `Body` **([String][51] \| [Buffer][57])** 

### json

Calls send with JSON.stringifyied data from the body

#### Parameters

-   `object`  
-   `Body` **([Object][52] \| [Array][54] \| [String][51] \| [Number][55])** 

### compress

Pipes data from zlib to the response

#### Parameters

-   `body`  
-   `Body` **([String][51] \| [Buffer][57] \| [Stream][56])?** 
-   `Encoding` **[String][51]** ( can be gzip, br, and deflate ), defaults to auto

### error

Displays an error message or status

#### Parameters

-   `code`  
-   `message`   (optional, default `http.STATUS_CODES[code]`)
-   `title`   (optional, default `code`)
-   `HTTP` **[Number][55]** status code
-   `Message` **([String][51] \| [Error][58] \| [Number][55] \| [Object][52] \| [Array][54])** , util.format is called on errors and has <pre> tags added

### redirect

Sets the status code and location header

#### Parameters

-   `status`  
-   `redir`  
-   `Status` **[Number][55]?** Param can be the location and will be set to 302
-   `URL` **([String][51] \| [URL][50])** 

### contentType

Sets the content-type header

#### Parameters

-   `value`  
-   `Content` **[String][51]** type

## sanitize

Sanitizes a string

### Parameters

-   `string`  
-   `String`  

Returns **[String][51]** 

## server

**Extends events**

Create an http(s) server with config provided

### Parameters

-   `config` **[Object][52]?** 
    -   `config.port` **[Number][55]?** Listening port
    -   `config.address` **[String][51]?** Listening address
    -   `config.type` **[String][51]?** Server type, can be http, https, http2, defaults to if SSL is provided = https, otherwise http
-   `Object`  ssl] - SSL data

### alias

An internal redirect

#### Parameters

-   `path` **[String][51]** 
-   `alias` **[String][51]** 

## etag

Generates a ETag

### Parameters

-   `data`  
-   `Data` **([String][51] \| [Buffer][57] \| [Stream][56] \| [Number][55])** 

Returns **[String][51]** ETag

## static

Static directory handler

### Parameters

-   `root` **[String][51]** Root directory
-   `options`   (optional, default `{}`)

### Examples

```javascript
var nodehttp = require('sys-nodehttp'),
	server = new nodehttp.server({ log_ready: true });

server.use(nodehttp.static('public', { listing: [ '/images' ] }));
// The root of the server will be from a relative folder named public, visiting /images will show a directory listing of the folder named images (if it exists)
```

[1]: #fetch

[2]: #parameters

[3]: #request

[4]: #parameters-1

[5]: #properties

[6]: #process

[7]: #response

[8]: #parameters-2

[9]: #properties-1

[10]: #status

[11]: #parameters-3

[12]: #get

[13]: #parameters-4

[14]: #set

[15]: #parameters-5

[16]: #append

[17]: #parameters-6

[18]: #finalize

[19]: #pipe_from

[20]: #parameters-7

[21]: #pipe

[22]: #parameters-8

[23]: #write

[24]: #parameters-9

[25]: #end

[26]: #parameters-10

[27]: #send

[28]: #parameters-11

[29]: #json

[30]: #parameters-12

[31]: #compress

[32]: #parameters-13

[33]: #error

[34]: #parameters-14

[35]: #redirect

[36]: #parameters-15

[37]: #contenttype

[38]: #parameters-16

[39]: #sanitize

[40]: #parameters-17

[41]: #server

[42]: #parameters-18

[43]: #alias

[44]: #parameters-19

[45]: #etag

[46]: #parameters-20

[47]: #static

[48]: #parameters-21

[49]: #examples

[50]: https://developer.mozilla.org/docs/Web/API/URL/URL

[51]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[52]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[53]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[54]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[55]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[56]: https://nodejs.org/api/stream.html

[57]: https://nodejs.org/api/buffer.html

[58]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error
